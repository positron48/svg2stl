# SVG to STL Converter

Скрипт на Python для преобразования SVG-файлов (в частности, негативных масок печатных плат, экспортированных из KiCad) в 3D-модели формата STL для фотополимерной печати.

## Описание

Этот инструмент автоматизирует процесс преобразования SVG-файлов, экспортированных из KiCad (с черной заливкой, представляющей негатив маски печатной платы), в точные 3D-модели в формате STL для использования с фотополимерными принтерами, такими как Photon Mono X6KS.

## Особенности

- Преобразование SVG-файлов в высококачественные 3D-модели STL
- Точное определение и извлечение только черных элементов из SVG (трасс и контуров плат)
- Автоматическая обрезка до фактических границ содержимого, значительно уменьшающая размер модели
- Обработка отдельных файлов или всех SVG-файлов в каталоге
- Настраиваемые параметры для толщины и размера пикселя (разрешения)
- Автоматический расчет оптимального DPI для растеризации на основе размера пикселя
- Оптимизированный алгоритм для быстрой обработки больших изображений
- Индикатор прогресса для отслеживания процесса конвертации

## Требования

Скрипт требует Python 3 и следующие пакеты:
```
numpy
cairosvg
pillow
numpy-stl
tqdm
```

Установка зависимостей:
```
pip install -r requirements.txt
```

## Использование

### Преобразование одного SVG-файла:

```
python svg2stl.py input.svg --thickness 1.0 --pixel_size 0.05
```

### Преобразование всех SVG-файлов в текущем каталоге:

```
python svg2stl.py --all --thickness 1.0 --pixel_size 0.05
```

### Параметры:

- `--thickness`: Толщина результирующей 3D-модели в мм (по умолчанию: 1.0)
- `--pixel_size`: Размер каждого пикселя в мм (по умолчанию: 0.05). Определяет разрешение растеризации и детализацию модели
- `--debug`: Сохранять обрезанное изображение для проверки

## Расчет разрешения

Скрипт автоматически рассчитывает оптимальное значение DPI на основе размера пикселя, чтобы обеспечить точные размеры STL-модели:

| Размер пикселя | Рассчитанный DPI | Качество | Размер файла | Время обработки |
|----------------|------------------|----------|--------------|-----------------|
| 0.025 мм       | 1200 DPI         | Очень высокое | Очень большой | Долго |
| 0.05 мм        | 600 DPI          | Высокое  | Большой (~130 МБ) | ~9 сек |
| 0.1 мм         | 300 DPI          | Среднее  | Умеренный (~20 МБ) | ~2 сек |
| 0.2 мм         | 150 DPI          | Низкое   | Малый (~5 МБ) | Менее 1 сек |

Используется формула: `DPI = 30 / pixel_size`

## Рекомендации по производительности

Размер пикселя (`pixel_size`) полностью определяет разрешение и детализацию модели:

- **Высокое качество и точность**: `--pixel_size 0.05` (DPI: 600)
- **Хороший баланс качества и производительности**: `--pixel_size 0.1` (DPI: 300)
- **Быстрая обработка с приемлемым качеством**: `--pixel_size 0.2` (DPI: 150)
- **Чрезвычайно высокое качество**: `--pixel_size 0.025` (DPI: 1200, требует много памяти)

```
python svg2stl.py input.svg --thickness 1.0 --pixel_size 0.1
```

Благодаря умной обрезке по содержимому скрипт обрабатывает только фактические элементы платы, игнорируя пустые поля.

**Пример производительности:**
- Размер исходного SVG: ~43KB
- Преобразование SVG в STL с pixel_size=0.1 (300 DPI): ~2 секунды
- Преобразование SVG в STL с pixel_size=0.05 (600 DPI): ~9 секунд
- Размеры выходных STL: ~20MB при pixel_size=0.1, ~130MB при pixel_size=0.05

## Процесс преобразования

1. SVG-файл растеризуется в PNG-изображение с разрешением DPI, рассчитанным на основе размера пикселя
2. Выполняется извлечение только черных элементов из SVG (трасс и контуров плат)
3. Изображение автоматически обрезается до фактических границ содержимого, игнорируя пустые поля
4. Создается бинарная маска, представляющая тело печатной платы
5. Каждый пиксель в маске выдавливается для создания 3D-модели с указанной толщиной
6. Модель сохраняется в виде STL-файла с тем же базовым именем, что и входной SVG

## Примеры

Преобразование экспорта медного слоя KiCad в STL толщиной 0.8 мм с высоким разрешением (600 DPI):
```
python svg2stl.py board-F_Cu.svg --thickness 0.8 --pixel_size 0.05
```

Обработка всех SVG-файлов с очень высоким разрешением (1200 DPI):
```
python svg2stl.py --all --thickness 1.0 --pixel_size 0.025
```

Быстрая обработка большого файла с более низким разрешением (300 DPI):
```
python svg2stl.py large-board.svg --thickness 1.0 --pixel_size 0.1
```

Сохранение отладочного изображения для проверки обрезки:
```
python svg2stl.py board-F_Cu.svg --thickness 1.0 --pixel_size 0.1 --debug
```
